# wardrobe: .
# costume: /colibri
---
name: colibri
description: >-
  desktop xfce4 plus all that I need to develop eggs, firmwares and anydesk
  repos
author: artisan
release: 0.9.2
distributions:
  - focal
  - jammy
  - noble
sequence:
  repositories:
    sources_list:
      - main
      - contrib
      - non-free
    update: true
    upgrade: true
  packages:
    - adwaita-qt
    # firefox removed
    - libxfce4ui-utils
    - lightdm
    - lightdm-gtk-greeter
    - network-manager-gnome
    - qt5ct
    - spice-vdagent
    - tango-icon-theme
    - thunar
    - xarchiver
    - xfce4-appfinder
    - xfce4-notifyd
    - xfce4-panel
    - xfce4-pulseaudio-plugin
    - xfce4-session
    - xfce4-settings
    - xfce4-terminal
    - xfce4-whiskermenu-plugin
    - xfconf
    - xfdesktop4
    - xfwm4
  accessories:
    - base
    - eggs-dev
    # firmwares
    # firmwares-light
    # flatpak
    # python3-dev
finalize:
  customize: true
  cmds:
   # --- Blocco 1: Rimozione GDM3 e impostazione LightDM ---
    - apt-get remove --purge -y gdm3
    - echo "/usr/sbin/lightdm" > /etc/X11/default-display-manager

    # --- Blocco 2: Rimozione e blocco completo di Snapd ---
    - systemctl stop snapd.service
    - systemctl disable snapd.service
    - apt-mark hold snapd
    - apt-get remove --purge -y snapd
    - rm -rf /var/cache/snapd/
    - rm -rf ~/snap

    # --- Blocco 3: Installazione Firefox nativo da PPA Mozilla ---
    - apt-get install -y software-properties-common apt-transport-https gpg
    - add-apt-repository -y ppa:mozillateam/ppa
    - sh -c 'echo "Package: firefox*" > /etc/apt/preferences.d/mozillateam'
    - sh -c 'echo "Pin: release o=LP-PPA-mozillateam" >> /etc/apt/preferences.d/mozillateam'
    - sh -c 'echo "Pin-Priority: 1001" >> /etc/apt/preferences.d/mozillateam'
    - apt-get update
    - apt-get install -y firefox

    # Imposta lightdm come display manager di default in modo non interattivo
    - echo "/usr/sbin/lightdm" > /etc/X11/default-display-manager  
    - ../../scripts/config_desktop_link.sh
    - ../../scripts/config_lightdm.sh
    - ../../scripts/config_g4.sh
    - ../../scripts/hostname.sh
reboot: true
