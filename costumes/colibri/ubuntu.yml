# wardrobe: .
# costume: /colibri
---
name: colibri
description: >-
  desktop xfce4 plus all that I need to develop eggs, firmwares and anydesk
  repos
author: artisan
release: 0.9.2
distributions:
  - jammy
  - noble
  - questing
sequence:
  repositories:
    sources_list:
      - main
      - contrib
      - non-free
    update: true
    upgrade: true
  packages:
    - adwaita-qt
    # firefox removed
    - libxfce4ui-utils
    - lightdm
    - lightdm-gtk-greeter
    - network-manager
    - network-manager-gnome
    - qt5ct
    - spice-vdagent
    - tango-icon-theme
    - thunar
    - xarchiver
    - xfce4-appfinder
    - xfce4-notifyd
    - xfce4-panel
    - xfce4-pulseaudio-plugin
    - xfce4-session
    - xfce4-settings
    - xfce4-terminal
    - xfce4-whiskermenu-plugin
    - xfconf
    - xfdesktop4
    - xfwm4
    - language-selector-gnome
    
  accessories:
    - base
    - eggs-dev
    # firmwares
    # firmwares-light
    # flatpak
    # python3-dev
finalize:
  customize: true
  cmds:
  # --- Blocco 1: Rimozione GDM3 e impostazione LightDM ---
  - apt-get remove --purge -y gdm3
  - echo "/usr/sbin/lightdm" > /etc/X11/default-display-manager

  # --- Blocco 2: Rimozione e blocco completo di Snapd ---
  - systemctl stop snapd.service
  - systemctl disable snapd.service
  - apt-get remove --purge -y snapd
  - apt-mark hold snapd
  - rm -rf /var/cache/snapd/
  - rm -rf ~/snap

  # --- Blocco 3: Rimozione sessioni GNOME/Ubuntu (Wayland e Xorg) ---
  # Rimuove i pacchetti che forniscono le sessioni di login standard di GNOME
  - apt-get remove --purge -y ubuntu-session gnome-session gnome-shell
  # Pulizia manuale (per sicurezza) dei file .desktop delle sessioni
  - rm -f /usr/share/xsessions/ubuntu.desktop
  - rm -f /usr/share/xsessions/gnome.desktop
  - rm -f /usr/share/wayland-sessions/ubuntu.desktop
  - rm -f /usr/share/wayland-sessions/gnome.desktop

  # --- Blocco 4: Configurazione NetworkManager ---
  # (Questo era il tuo Blocco 5)
  - systemctl stop systemd-networkd.service
  - systemctl disable systemd-networkd.service
  - systemctl disable systemd-networkd.socket
  - systemctl enable NetworkManager.service    

  # --- Blocco 5: Installazione Firefox nativo da PPA Mozilla ---
  # (Questo era il tuo Blocco 3)
  - apt-get install -y software-properties-common apt-transport-https gpg
  - add-apt-repository -y ppa:mozillateam/ppa
  - sh -c 'echo "Package: firefox*" > /etc/apt/preferences.d/mozillateam'
  - sh -c 'echo "Pin: release o=LP-PPA-mozillateam" >> /etc/apt/preferences.d/mozillateam'
  - sh -c 'echo "Pin-Priority: 1001" >> /etc/apt/preferences.d/mozillateam'
  - apt-get update
  - apt-get install -y firefox-esr

  # --- Blocco 6: Script di finalizzazione ---
  # (Ho rimosso il duplicato di echo lightdm da qui)
  - ../../scripts/config_desktop_link.sh
  - ../../scripts/config_lightdm.sh
  - ../../scripts/config_g4.sh
  - ../../scripts/hostname.sh
reboot: true
